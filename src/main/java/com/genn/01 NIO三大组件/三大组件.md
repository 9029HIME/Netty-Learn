# NIO三大组件

![image-20201220170845912](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20201220170845912.png)

​	Channel：对流的封装，是数据承载体的传输管道，支持全双工（读和写）。

​	Buffer：本质是一个内存块，底层结构是数组，是数据的承载体，**也是实现非阻塞的核心**。

（ByteBuffer可以直接映射操作系统，减少程序缓冲区和内核缓冲区之间的拷贝）

​	Selector：多个Channel绑定Selector，Selector根据Channel的事件触发情况，选择为其服务（分配一个线程），类似于调度器。**不会因为其中一个通道而阻塞，当其中一个通道事件未就绪，会等待其他通道事件就绪。**

​	总结：	

​	1.每一个Channel对应一个Buffer

​	2.Channel与Buffer都是双向的，数据的读取和写入都是通过Buffer。和BIO不同的是，BIO没有Buffer的概念，BIO也没有类似Channel的双向通道，而是直接通过输入流/输出流。



# Buffer

​	本质是一个可读写数据的**内存块**，底层数据结构是数组。

## Buffer种类

​	**ByteBuffer**、ShortBuffer、CharBuffer、IntBuffer、LongBuffer、DoubleBuffer、FloatBuffer，即除了布尔类型外，其他基本类型都有其Buffer。

## Buffer四大属性		

​	Capacity：缓冲区最大容量，与Golang的cap类似。

​	Limit：缓冲区最大可达**长度**，可以理解为length。

​	Position：**下一次**要操作的数据**下标**。

​	Mark：标记用，用来标记上一次的position位置

## flip()

​	Buffer的方法，表示Buffer从写状态变为读状态。此时Buffer的position变为0，limit变为position。具体如下图

## 只读Buffer

​	可以通过Buffer的asReadOnlyBuffer()变成只读Buffer，如果往里面写数据会抛异常。

## MappedBuffer

​	并非KV-Buffer，而是一种直接在内存（堆外内存）修改文件，不需要操作系统进行拷贝的Buffer，属于操作系统级别的修改**（这一部分后续要了解下原理）**。



# Channel

​	通道可以同时进行读写，数据是从Buffer从读，也是往Buffer中写。

## Channel的子类

​	1.FileChannel：对文件进行操作

​	2.DatagramChannel：用于对UDP数据读写

​	继承自NetworkChannel：

​	3.ServerSocketChannel：类似ServerSocket

​	4.SocketChannel：类似Socket

## Buffer与Channel共用

com.genn.AppTest#writeFileChannel

com.genn.AppTest#readFileChannel

com.genn.AppTest#oneBufferCopy

com.genn.AppTest#noBufferCopy